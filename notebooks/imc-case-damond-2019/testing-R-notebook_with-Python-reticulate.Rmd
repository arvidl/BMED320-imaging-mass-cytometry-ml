---
title: "Testing an R Notebook for Python (reticulate)"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.


https://teachdatascience.com/reticulate

https://rstudio-pubs-static.s3.amazonaws.com/188357_03392d56ec074b5e947b17ca8976d8be.html


```{r}
library(reticulate)
wd <- '/Users/arvid/GitHub/BMED320-imaging-mass-cytometry-ml/notebooks/imc-case-damond-2019'
setwd(wd)
print(getwd())
os <- import("os")
os$listdir()
```


```{r}
library(reticulate)
# cat $HOME/.Renviron
# RETICULATE_PYTHON="/Users/arvid/opt/anaconda3/envs/imc/bin/python"
print(Sys.which("python"))
use_python("/Users/arvid/opt/anaconda3/envs/imc/bin/python", required=TRUE)
print(Sys.which("python"))
use_condaenv(condaenv ="imc", conda = "auto", required = TRUE)
```

```{r}
library("reticulate")
py_discover_config()
```



```{python}
import pandas as pd
fn = 'test_data/flights.csv'
flights = pd.read_csv(fn, sep = ';')
flights = flights[flights['dest'] == 'ORD']
flighhs = flights[['carrier', 'dep_delay', 'arr_delay']]
flights = flights.dropna()
flights['month'] = pd.DatetimeIndex(flights['date']).month
flights.columns.T
```


```{python}
flights.shape
flights.head(5)
flights.describe()
```


```{python}
flights.groupby('carrier').mean()
```


```{r, fig.width=7, fig.height=3}
library(ggplot2)
ggplot(py$flights, aes(carrier, arr_delay)) + geom_point() + geom_jitter()
``` 


```{r}
library(dplyr)
py$flights %>%
  dplyr::select(carrier, dep_delay, arr_delay) %>%
  tidyr::drop_na() %>% 
  group_by(carrier) %>%
  summarize(mean_dep_delay = mean(dep_delay), mean_arr_delay = mean(arr_delay))
```


```{r}
library(ggplot2)
py$flights %>%
  tidyr::drop_na() %>%
  group_by(carrier, month) %>%
  summarize(mean_dep_delay = mean(dep_delay)) %>% 
  ggplot(aes(x=as.factor(month), y = mean_dep_delay, group = carrier, color=carrier))  + 
  geom_point() + geom_line() + xlab("Month") + ylab("Average Departure Delay")
```  


  
